from ubuntu:latest

RUN apt update -yqq \
    && apt upgrade -yqq \
    && apt install -y unzip \
        python3 python3-pip \
        libpq-dev \
    && rm -rf /var/lib/apt/lists/*  

RUN pip3 install --upgrade pip

RUN pip3 install \
    flask-testing \
    selenium \
    pytest \
    flask \
    flask-bootstrap \
    flask-sqlalchemy \
    flask-migrate \
    flask-wtf \
    flask_fontawesome \
    pyvirtualdisplay \
    pytest-cov \
    pytest-profiling \
    pylint \
    pycodestyle \
    psycopg2 \
    waitress

ENV LC_ALL=C.UTF-8 \
    LANG=C.UTF-8 \
    DATABASE_URL=postgresql+psycopg2://postgres:root@db:5432/postgres

EXPOSE 5000

RUN mkdir /logs && chmod -R 777 /logs

COPY ./dist/*.whl /

RUN pip3 install *.whl

CMD echo "Starting Server..." && waitress-serve --call 'quasimodo_website:create_app'
